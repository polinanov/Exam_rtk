# Двуфакторная авторизация

**Акторы:** пользователь, фронтент, бекенд, БД.

**Цель:** пользователь авторизуется на сайте, чтобы получить доступ к недоступным неавторизированным пользователям разделам.

**Предусловия:** у пользователя открыта страница сайта двухфакторной авторизации.

**Сценарий:**
. Пользователь вводит данные в поля формы авторизации (обязательное поле номер телефона) и отправляет заполненную форму.
. Фронтент посылает POST-запрос с пользовательскими данными и отображает пользователю поле ввода  СМС-кода и кнопку повторной отправки  СМС-кода.

Пользователь хочет [повторно отослать код](#Повторная_отправка_кода).  

. Бекенд посылает запрос на получение данных из БД (пользовательские данные).
. БД возвращает ответ "пользовательские данные найдены".  

БД возвращает ответ ["пользовательские данные ненайдены"](#Пользовательские_данные_ненайдены).  

. Бекенд генерирует код для подтверждения личности пользователя.
. Бекенд посылает запрос на запись/изменение в БД сгенерированного кода.  
. БД возвращает ответ "данные обновлены".
. Бекенд отправляет сгенерированный код на SMSC.
. SMSC, используя SMS-шлюз, передает сгенерированный код SMSC мобильного оператора.
. SMSC мобильного оператора отправляет пользователю мобильное устройство сгенерированный код.  
. Пользователь получил код СМС-сообщением (на телефон, который он указывал при регистрации).  

Пользователь не получил код [повторно отослать код](#Повторная_отправка_кода).  

. Пользователь вводит код из СМС-сообщения в форму.
. Фронтент посылает POST-запрос с введенным кодом.
. Бекенд посылает запрос на получение данных из БД (пользовательские данные + код).
. БД возвращает ответ "код правильный".  

БД возвращает ответ ["код не правильный"](#Код_не_правильный).  

. Бекенд начинает веб-сессию для пользователя.
. Фронтен отображает пользователю нужные разделы.

**Результат:**
* Пользователь успешно получил доступ к недоступным разделам.



**Альтернативный сценарий:**

3а. <a name="Повторная_отправка_кода"></a> *Повторная отправка кода*.  

3а1. Приложение отправляет запрос на совершение видеоозвонка пользователю, которому звонят.  
3а2. Приложение ждет ответа от пользователя, которому звонят (30 сек).  
3а3. Приложение получает ответ от пользователя, которому звонят.  

Приложение получает ответ ["Пользователь не отвечает" (или "Пользователь занят" или "Пользователь разговаривает")](#Пользователь_не_отвечает) от пользователя, которому звонят.

3а4. Приложение отправляет запрос на совершение видеозвонка.  
3а5. Приложение просит пользователя включить микрофон и камеру.  
3а6. Приложение открывает соединение (канал связи) для предачи данных в цифровом виде, используя протокол IP.  

Возврат на шаг 10 {Успешное завершение аудиозвонка}.



6а. <a name="Пользователь_не_отвечает"></a> *Пользователь не отвечает (или "Пользователь занят" или "Пользователь разговаривает")*.  

6а1. Приложение уведомляет пользователя о неуспешной попытке аудио- (или видео-) звонка.  
6а2. Приложение сохраняет данные о неуспешной попытке звонка в БД (никнеймы пользователей, дата и время звонка).   
6а2. Приложение уведомляет пользователя (которому пытались позвонить) о неуспешной попытке звонка от пользователя, который звонил.  

# Диаграмма activity
![activity]( "Диаграмма activity")

# Диаграмма sequence
![sequence]( "Диаграмма sequence")

